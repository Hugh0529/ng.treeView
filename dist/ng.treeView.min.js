angular.module("ng.treeView",[]).directive("angularTreeview",["$compile",function(e){return{restrict:"A",link:function(a,n,t){Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var a=0;a<this.length;a++)if(this[a]==e)return a;return-1});var c=t.treeId,l=t.treeModel||a[c].treeModel,d=t.nodeId||(a[c]&&a[c].nodeId?a[c].nodeId:"id"),o=t.nodeLabel||(a[c]&&a[c].nodeLabel?a[c].nodeLabel:"label"),r=t.nodeChildren||(a[c]&&a[c].nodeChildren?a[c].nodeChildren:"children"),i=t.collapsedStyle||(a[c]&&a[c].collapsedStyle?a[c].collapsedStyle:"collapsed"),s=t.expandedStyle||(a[c]&&a[c].expandedStyle?a[c].expandedStyle:"expanded"),h=t.normalStyle||(a[c]&&a[c].normalStyle?a[c].normalStyle:"normal"),u=t.searchLabelName||(a[c]&&a[c].searchLabel?a[c].searchLabel:"searchLabel"),g=a[u]||"",f=t.selectedKey||(a[c]&&a[c].selectedKey?a[c].selectedKey:"id"),k=t.iconMode||(a[c]&&a[c].iconMode?a[c].iconMode:"i"),b="",p='data-ng-checked="'+c+'.isCheckboxChecked(node)"',L='data-ng-checked="'+c+'.isRadioChecked(node)"',C="";switch(k){case"radio":b='<input type="'+k+'" name="'+c+'"data-ng-show="!node.'+r+'.length" id = "{{node.'+d+'}}"'+L+"/>";break;case"checkbox":b='<input type="'+k+'" name="'+c+'"class="tree-checkbox"data-ng-show="!node.'+r+'.length" id = "{{node.'+d+'}}"'+p+"/>",C='<input type="'+k+'" name="'+c+'"class="tree-checkbox tree-parent-checkbox"data-ng-show="node.'+r+'.length" data-ng-checked="'+c+'.isParentCheckboxChecked(node)"data-ng-click="'+c+'.checkParentCheckbox(node)"id = "{{node.'+d+'}}"/>';break;case"i":b='<i class="'+h+'" data-ng-show="!node.'+r+'.length"></i> '}var x='<ul><li data-ng-repeat="node in '+l+'"data-ng-show="'+c+'.search(node) || node.search"><i data-ng-class="{'+i+": node.collapsed,"+s+': !node.collapsed}"data-ng-show="node.'+r+'.length"data-ng-click="'+c+'.selectNodeHead(node)"></i>'+C+'<span data-ng-class="{selected : node.selected && !node.'+r+'.length}" data-ng-click="'+c+'.selectNodeLabel(node)">'+b+"<span>{{node."+o+'}}</span></span><div data-ng-hide="node.collapsed" data-angular-treeview data-tree-id="'+c+'"" data-tree-model="node.'+r+'"" data-node-id="'+d+'"data-node-label="'+o+'"data-node-children="'+r+'"data-icon-mode="'+k+'"></div></li></ul>';if(!c||!l)throw new Error("must set treeId && treeModel");a[c]=a[c]||{},a[c].selectNodeHead=a[c].selectNodeHead||function(e){e.collapsed=!e.collapsed,angular.isFunction(a[c].treeSelectNodeHeadCallBack)&&a[c].treeSelectNodeHeadCallBack(e)},a[c].selectNodeLabel=a[c].selectNodeLabel||function(e){a[c].currentNode&&a[c].currentNode.selected&&(a[c].currentNode.selected=void 0),angular.isArray(e[r])&&e[r].length&&a[c].selectNodeHead(e),e.selected="selected",a[c].currentNode=e,angular.equals(k,"checkbox")&&a[c].checkLabel(e),!angular.isFunction(a[c].treeSelectNodeLabelCallBack)||e[r]&&e[r].length||a[c].treeSelectNodeLabelCallBack(e)},a[c].search=a[c].search||function(e,a){return g=angular.isDefined(a)?a:g,e[o]&&angular.lowercase(e[o]).indexOf(angular.lowercase(g))>-1?(e[r]&&e[r].length&&angular.forEach(e[r],function(e){e.search=!0}),!0):function e(a){return!(!a[r]||!a[r].length)&&angular.forEach(a[r],function(a){return angular.lowercase(a[o]).indexOf(angular.lowercase(g))>-1||void e(a)})}(e)},a.getSearchLabel=function(){return a[u]};var y=function(e){e.search=!1,e.children.length&&angular.forEach(e.children,function(e){y(e)})};a.$watch(a.getSearchLabel,function(e,n){e!==n&&angular.forEach(a[l],function(n){y(n),a[c].search(n,e)})},!0),a[c].selectedList=a[c].selectedList||[],a[c].checkLabel=a[c].checkLabel||function(e){var n=-1;if(!e[d]||!angular.isArray(a[c].selectedList))throw new Error("must set nodeId and selectedList must be array");e[r]&&e[r].length||(n=a[c].selectedList.indexOf(e[d]),n>-1?a[c].selectedList.splice(n,1):a[c].selectedList.push(e[d]))},a[c].isCheckboxChecked=a[c].isCheckboxChecked||function(e){return e[d]&&a[c].selectedList.indexOf(e[d])>-1},a[c].isRadioChecked=a[c].isRadioChecked||function(e){return e[d]===a[f]},a[c].selectAll=a[c].selectAll||function(e){var n=function(e){angular.isArray(e[r])&&e[r].length?angular.forEach(e[r],function(e){n(e)}):a[c].selectedList.push(e[d])},t=e||a[l];angular.forEach(t,n),angular.isFunction(a[c].selectAllCallback)&&a[c].selectAllCallback()},a[c].removeAll=a[c].removeAll||function(){a[c].selectedList=[],angular.isFunction(a[c].removeAllCallback)&&a[c].removeAllCallback()},a[c].check=a[c].check||function(e){var a=document.getElementById(e);a&&(a.checked=!0)},a[c].isParentCheckboxChecked=a[c].isParentCheckboxChecked||function(e){var n=!0,t=function(e){n===!0&&angular.forEach(e[r],function(e){var t=-1;e[r]&&e[r].length?foo(e):(t=a[c].selectedList.indexOf(e[d]),t<=-1&&(n=!1))})};return t(e),n},a[c].checkParentCheckbox=a[c].checkParentCheckbox||function(e){var n=function(e){angular.forEach(e[r],function(e){var t=-1;e[r]&&e[r].length?n(e):(t=a[c].selectedList.indexOf(e[d]),t<=-1&&a[c].selectedList.push(e[d]))})},t=function(e){angular.forEach(e[r],function(e){var n=-1;e[r]&&e[r].length?t(e):(n=a[c].selectedList.indexOf(e[d]),n>-1&&a[c].selectedList.splice(n,1))})};a[c].isParentCheckboxChecked(e)?t(e):n(e)},n.html("").append(e(x)(a))}}}]);